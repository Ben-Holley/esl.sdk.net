using NUnit.Framework;
using System;
using Silanis.ESL.API;
using Newtonsoft.Json;

namespace SDK.Tests
{
    [TestFixture()]
    public class UnknownEnumValuesHandleConverterTest
    {
        private JsonSerializerSettings settings;
        private string response;

        [SetUp()]
        public void Init()
        {
            configureJsonSerializationSettings();
        }
        [Test()]
        public void TestDeserializeUsingUnknownEnumValueForFieldSubType()
        {
            response = "{\"signedDocumentDelivery\":null,\"notaryRoleId\":null,\"completed\":null,\"trashed\":false,\"due\":null,\"autocomplete\":true,\"notarized\":false,\"documents\":[{\"extract\":false,\"pages\":[{\"height\":1030.0,\"width\":796.0,\"left\":0.0,\"index\":0,\"top\":0.0,\"version\":1,\"id\":\"default-consent_1.png\"},{\"height\":1030.0,\"width\":796.0,\"left\":0.0,\"index\":1,\"top\":0.0,\"version\":2,\"id\":\"default-consent_2.png\"}],\"approvals\":[],\"external\":{\"providerName\":null,\"provider\":\"e-SignLive\",\"id\":\"esl\",\"data\":null},\"index\":0,\"description\":\"Must be accepted and agreed to before starting the signing process.\",\"id\":\"default-consent\",\"data\":null,\"fields\":[],\"name\":\"Electronic Disclosures and Signatures Consent\",\"size\":0},{\"extract\":false,\"pages\":[{\"height\":1030.0,\"width\":796.0,\"left\":0.0,\"index\":0,\"top\":0.0,\"version\":3,\"id\":\"adf0434b21901df6_1.png\"}],\"approvals\":[{\"accepted\":null,\"signed\":null,\"role\":\"Ir9mVXExlx85\",\"id\":\"12885246-4e00-44f8-8e8c-5052c7706135\",\"data\":null,\"fields\":[{\"extractAnchor\":null,\"validation\":null,\"extract\":false,\"height\":29.999969482421875,\"width\":150.00050354003906,\"top\":199.99978637695312,\"page\":0,\"left\":0.0,\"type\":\"INPUT\",\"binding\":null,\"subtype\":\"TEXTAREA\",\"id\":\"0OY6gQJy4uY7\",\"data\":null,\"value\":\"text area default value\",\"name\":\"text area name\"},{\"extractAnchor\":null,\"validation\":null,\"extract\":false,\"height\":29.999969482421875,\"width\":150.00050354003906,\"top\":199.99978637695312,\"page\":0,\"left\":0.0,\"type\":\"INPUT\",\"binding\":null,\"subtype\":\"UNKNOWN_VALUE\",\"id\":\"ZzNqOO19oX8V\",\"data\":null,\"value\":\"unknown Value default value\",\"name\":\"unknown Value name\"},{\"extractAnchor\":null,\"validation\":{\"errorMessage\":\"\",\"enum\":[\"first value\",\"second value\",\"third value\"],\"maxLength\":null,\"minLength\":null,\"required\":false,\"errorCode\":null,\"pattern\":\"\"},\"extract\":false,\"height\":29.999969482421875,\"width\":150.00050354003906,\"top\":100.00003051757812,\"page\":0,\"left\":0.0,\"type\":\"INPUT\",\"binding\":null,\"subtype\":\"LIST\",\"id\":\"xXjvB6oKNEoK\",\"data\":null,\"value\":\"\",\"name\":\"drop list name\"},{\"extractAnchor\":null,\"validation\":{\"errorMessage\":\"\",\"enum\":[\"groupName\"],\"maxLength\":null,\"minLength\":null,\"required\":false,\"errorCode\":null,\"pattern\":\"\"},\"extract\":false,\"height\":19.99997901916504,\"width\":19.99997901916504,\"top\":100.00003051757812,\"page\":0,\"left\":299.99969482421875,\"type\":\"INPUT\",\"binding\":null,\"subtype\":\"RADIO\",\"id\":\"HgEKfl0O98sV\",\"data\":null,\"value\":\"\",\"name\":\"\"},{\"extractAnchor\":null,\"validation\":{\"errorMessage\":\"\",\"enum\":[\"groupName\"],\"maxLength\":null,\"minLength\":null,\"required\":false,\"errorCode\":null,\"pattern\":\"\"},\"extract\":false,\"height\":19.99997901916504,\"width\":19.99997901916504,\"top\":199.99978637695312,\"page\":0,\"left\":299.99969482421875,\"type\":\"INPUT\",\"binding\":null,\"subtype\":\"RADIO\",\"id\":\"sDWjKm7HKY4M\",\"data\":null,\"value\":\"\",\"name\":\"\"},{\"extractAnchor\":null,\"validation\":{\"errorMessage\":\"\",\"enum\":[\"groupName\"],\"maxLength\":null,\"minLength\":null,\"required\":false,\"errorCode\":null,\"pattern\":\"\"},\"extract\":false,\"height\":19.99997901916504,\"width\":19.99997901916504,\"top\":299.99969482421875,\"page\":0,\"left\":299.99969482421875,\"type\":\"INPUT\",\"binding\":null,\"subtype\":\"RADIO\",\"id\":\"yRYz1QMPfBE7\",\"data\":null,\"value\":\"\",\"name\":\"\"},{\"extractAnchor\":null,\"validation\":{\"errorMessage\":\"\",\"enum\":[\"groupName\"],\"maxLength\":null,\"minLength\":null,\"required\":false,\"errorCode\":null,\"pattern\":\"\"},\"extract\":false,\"height\":19.99997901916504,\"width\":19.99997901916504,\"top\":399.99957275390625,\"page\":0,\"left\":299.99969482421875,\"type\":\"INPUT\",\"binding\":null,\"subtype\":\"RADIO\",\"id\":\"74K3t2giCAgT\",\"data\":null,\"value\":\"\",\"name\":\"\"},{\"extractAnchor\":null,\"validation\":{\"errorMessage\":\"\",\"enum\":[\"groupName\"],\"maxLength\":null,\"minLength\":null,\"required\":false,\"errorCode\":null,\"pattern\":\"\"},\"extract\":false,\"height\":19.99997901916504,\"width\":19.99997901916504,\"top\":499.9994812011719,\"page\":0,\"left\":299.99969482421875,\"type\":\"INPUT\",\"binding\":null,\"subtype\":\"RADIO\",\"id\":\"zIcwmFl3DNEX\",\"data\":null,\"value\":\"\",\"name\":\"\"},{\"extractAnchor\":null,\"validation\":{\"errorMessage\":\"\",\"enum\":[\"group1\"],\"maxLength\":2147483647,\"minLength\":0,\"required\":false,\"errorCode\":0,\"pattern\":\"^[\\\\s0-9a-zA-Z]+$\"},\"extract\":false,\"height\":49.99994659423828,\"width\":199.99978637695312,\"top\":100.00003051757812,\"page\":0,\"left\":399.99957275390625,\"type\":\"INPUT\",\"binding\":null,\"subtype\":\"RADIO\",\"id\":\"fieldId1\",\"data\":null,\"value\":\"X\",\"name\":\"field1\"},{\"extractAnchor\":null,\"validation\":{\"errorMessage\":\"\",\"enum\":[\"group1\"],\"maxLength\":2147483647,\"minLength\":0,\"required\":false,\"errorCode\":0,\"pattern\":\"^[\\\\s0-9a-zA-Z]+$\"},\"extract\":false,\"height\":49.99994659423828,\"width\":199.99978637695312,\"top\":199.99978637695312,\"page\":0,\"left\":399.99957275390625,\"type\":\"INPUT\",\"binding\":null,\"subtype\":\"RADIO\",\"id\":\"fieldId2\",\"data\":null,\"value\":\"\",\"name\":\"field2\"},{\"extractAnchor\":null,\"validation\":{\"errorMessage\":\"\",\"enum\":[\"group1\"],\"maxLength\":2147483647,\"minLength\":0,\"required\":false,\"errorCode\":0,\"pattern\":\"^[\\\\s0-9a-zA-Z]+$\"},\"extract\":false,\"height\":49.99994659423828,\"width\":199.99978637695312,\"top\":299.99969482421875,\"page\":0,\"left\":399.99957275390625,\"type\":\"INPUT\",\"binding\":null,\"subtype\":\"RADIO\",\"id\":\"fieldId3\",\"data\":null,\"value\":\"\",\"name\":\"field3\"},{\"extractAnchor\":null,\"validation\":null,\"extract\":false,\"height\":29.999969482421875,\"width\":150.00050354003906,\"top\":299.99969482421875,\"page\":0,\"left\":0.0,\"type\":\"SIGNATURE\",\"binding\":null,\"subtype\":\"FULLNAME\",\"id\":\"4fb42dcc-ba13-4097-942e-b9d28d0954ea\",\"data\":null,\"value\":\"\",\"name\":\"\"}],\"name\":\"\"}],\"external\":null,\"index\":1,\"description\":\"\",\"id\":\"af050f74414b96ab\",\"data\":null,\"fields\":[],\"name\":\"Default Document Name\",\"size\":0}],\"limits\":null,\"messages\":[],\"consent\":\"default-consent\",\"settings\":{\"ceremony\":{\"optOutButton\":true,\"declineReasons\":[],\"optOutReasons\":[],\"maxAuthFailsAllowed\":3,\"declineButton\":true,\"inPerson\":true,\"hideCaptureText\":false,\"hideWatermark\":false,\"disableDownloadForUncompletedPackage\":false,\"disableFirstInPersonAffidavit\":false,\"disableInPersonAffidavit\":false,\"disableSecondInPersonAffidavit\":false,\"documentToolbarOptions\":null,\"handOver\":null,\"hideLanguageDropdown\":false,\"hidePackageOwnerInPerson\":false,\"style\":null,\"layout\":{\"brandingBar\":null,\"footer\":null,\"iframe\":false,\"navigator\":true,\"header\":{\"globalActions\":{\"saveAsLayout\":true,\"confirm\":true,\"download\":true,\"hideEvidenceSummary\":false},\"feedback\":true,\"titleBar\":{\"title\":true,\"progressBar\":true},\"breadcrumbs\":true,\"globalNavigation\":true,\"sessionBar\":true}},\"events\":{\"complete\":{\"redirect\":null,\"dialog\":true}}}},\"emailMessage\":\"\",\"updated\":\"2014-12-02T21:28:35Z\",\"sender\":{\"userCustomFields\":[],\"locked\":null,\"memberships\":[],\"professionalIdentityFields\":[],\"activated\":null,\"updated\":\"2014-12-02T21:28:33Z\",\"account\":{\"updated\":\"2014-12-04T16:27:43Z\",\"logoUrl\":\"\",\"providers\":null,\"company\":{\"id\":\"bnGKOy44UcpB\",\"data\":null,\"address\":{\"address1\":null,\"address2\":null,\"city\":null,\"country\":null,\"zipcode\":null,\"state\":null},\"name\":\"\"},\"customFields\":[],\"licenses\":[{\"plan\":{\"contract\":\"MONTH\",\"cycle\":\"MONTH\",\"freeCycles\":{\"cycle\":\"MONTH\",\"count\":1},\"quotas\":[{\"cycle\":null,\"limit\":11,\"scope\":\"ACCOUNT\",\"target\":\"SENDER\"},{\"cycle\":null,\"limit\":500,\"scope\":\"SENDER\",\"target\":\"DOCUMENT\"},{\"cycle\":null,\"limit\":500,\"scope\":\"SENDER\",\"target\":\"STORAGE\"}],\"price\":{\"amount\":3999,\"currency\":{\"id\":\"USD\",\"data\":null,\"name\":\"US Dollar\"}},\"original\":null,\"group\":\"Premium\",\"features\":null,\"description\":\"E-Sign Hundreds of Documents with Unlimited Signers\",\"id\":\"premium\",\"data\":null,\"name\":\"Premium\"},\"paidUntil\":\"2015-01-02T21:28:33Z\",\"transactions\":[],\"status\":\"ACTIVE\",\"created\":\"2014-12-02T21:28:33Z\"}],\"created\":\"2014-12-04T16:27:43Z\",\"id\":\"E0YDUd688lcI\",\"owner\":\"wpucbp0MbsFc\",\"data\":null,\"name\":\"not yet\"},\"firstName\":\"9W1tyVue9ScOdt8Ki4bz\",\"lastName\":\"lastName\",\"email\":\"waf4a9myw01vploxtmr8@e-signlive.com\",\"external\":null,\"phone\":null,\"company\":\"\",\"title\":null,\"status\":\"ACTIVE\",\"type\":\"MANAGER\",\"signature\":null,\"id\":\"wpucbp0MbsFc\",\"language\":\"en\",\"data\":{\"serviceCredentials\":\"{}\"},\"created\":\"2014-12-02T21:28:33Z\",\"address\":{\"address1\":null,\"address2\":null,\"city\":null,\"country\":null,\"zipcode\":null,\"state\":null},\"name\":\"\",\"specialTypes\":[]},\"visibility\":\"ACCOUNT\",\"status\":\"DRAFT\",\"roles\":[{\"reassign\":false,\"attachmentRequirements\":[],\"emailMessage\":null,\"locked\":false,\"specialTypes\":[],\"type\":\"SENDER\",\"index\":0,\"id\":\"n4HUhe4YdcgP\",\"data\":null,\"signers\":[{\"userCustomFields\":[],\"professionalIdentityFields\":[],\"knowledgeBasedAuthentication\":null,\"updated\":\"2014-12-04T16:27:43Z\",\"firstName\":\"9W1tyVue9ScOdt8Ki4bz\",\"lastName\":\"lastName\",\"email\":\"waf4a9myw01vploxtmr8@e-signlive.com\",\"external\":null,\"phone\":\"\",\"company\":\"\",\"title\":null,\"auth\":{\"challenges\":[],\"scheme\":\"NONE\"},\"delivery\":{\"download\":true,\"email\":true,\"provider\":false},\"group\":null,\"signature\":null,\"id\":\"wpucbp0MbsFc\",\"language\":\"en\",\"data\":null,\"created\":\"2014-12-04T16:27:43Z\",\"address\":null,\"name\":\"\",\"specialTypes\":[]}],\"name\":\"Owner\"},{\"reassign\":false,\"attachmentRequirements\":[],\"emailMessage\":null,\"locked\":false,\"specialTypes\":[],\"type\":\"SIGNER\",\"index\":0,\"id\":\"Ir9mVXExlx85\",\"data\":null,\"signers\":[{\"userCustomFields\":[],\"professionalIdentityFields\":[],\"knowledgeBasedAuthentication\":null,\"updated\":\"2014-12-04T16:27:43Z\",\"firstName\":\"firstName\",\"lastName\":\"lastName\",\"email\":\"ruplsyuxk1rmhgm983i1@e-signlive.com\",\"external\":null,\"phone\":\"\",\"company\":\"default company\",\"title\":\"default title\",\"auth\":{\"challenges\":[],\"scheme\":\"NONE\"},\"delivery\":{\"download\":false,\"email\":false,\"provider\":false},\"group\":null,\"signature\":null,\"id\":\"01d5f5af-08c3-427d-8a1c-e98fb1feae09\",\"language\":\"en\",\"data\":null,\"created\":\"2014-12-04T16:27:43Z\",\"address\":null,\"name\":\"\",\"specialTypes\":[]}],\"name\":\"ruplsyuxk1rmhgm983i1@e-signlive.com's role\"}],\"type\":\"PACKAGE\",\"description\":\"\",\"id\":\"0caad322-06fd-41b1-bc0e-7641d22d0e0d\",\"language\":\"en\",\"data\":null,\"name\":\"Default Package Name\"}";
            Package package = JsonConvert.DeserializeObject<Silanis.ESL.API.Package> (response, settings);
            Assert.AreEqual(Silanis.ESL.API.FieldSubtype.UPGRADE_NEEDED_VALUE, package.Documents[1].Approvals[0].Fields[1].Subtype);
        }

        private void configureJsonSerializationSettings()
        {
            settings = new JsonSerializerSettings ();
            settings.NullValueHandling = NullValueHandling.Ignore;
            settings.DateTimeZoneHandling = DateTimeZoneHandling.Utc;
            settings.Converters.Add( new UnknownEnumValuesHandleConverter() );
        }
    }
}